<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JeanMarie & Demetrios's Engagement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&family=Great+Vibes&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', sans-serif;
        }
        h1, h2, h3, .font-display {
            font-family: 'Playfair Display', serif;
        }
        /* Custom scrollbar for message board */
        #guestbook-messages::-webkit-scrollbar {
            width: 8px;
        }
        #guestbook-messages::-webkit-scrollbar-track {
            background: #f8fafc;
        }
        #guestbook-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .nav-link.active {
            /* Changed to white to show on dark header */
            border-bottom-color: #ffffff;
            color: #ffffff;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700">

    <!-- Password Protection Modal -->
    <div id="password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h2 class="text-3xl font-display mb-2">JeanMarie & Demetrios</h2>
            <p class="text-slate-500 mb-6">Please enter the password to view our site.</p>
            <form id="password-form">
                <!-- Accent color updated to slate -->
                <input id="password-input" type="password" class="w-full p-3 border border-slate-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-slate-500" placeholder="Password">
                <p id="password-error" class="text-red-500 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
                <!-- Button color updated to slate -->
                <button type="submit" class="w-full mt-4 bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors duration-300 font-bold">Enter</button>
            </form>
        </div>
    </div>

    <!-- Main App Content (hidden until password is correct) -->
    <div id="app-content" class="hidden">
        <!-- Header updated to match footer -->
        <header class="bg-slate-800 shadow-md sticky top-0 z-40">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <!-- Logo Added -->
                <div>
                    <img src="https://placehold.co/150x50/transparent/F472B6?text=J+%2B+D&font=great-vibes" alt="J + D Logo" class="h-12 -ml-2">
                </div>
                <div class="flex items-center space-x-4 md:space-x-6 text-lg overflow-x-auto">
                    <!-- Navigation links reordered -->
                    <a href="#home" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Home</a>
                    <a href="#photos" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Photos</a>
                    <a href="#registry" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Registry</a>
                    <a href="#guestbook" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Guestbook</a>
                    <a href="#schedule" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Schedule</a>
                    <a href="#local-guide" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Local Guide</a>
                </div>
            </nav>
        </header>

        <main>
            <!-- Home Section -->
            <section id="home-section" class="page-section container mx-auto px-6 py-16 md:py-24 text-center">
                <div class="mb-12">
                    <h1 class="text-5xl md:text-7xl font-display text-slate-800 mb-4">We're Engaged!</h1>
                    <p class="text-xl text-slate-500 max-w-3xl mx-auto">
                        We're so excited to share this special time in our lives with you. Welcome to our engagement website, where you can find event details, photos, and more.
                    </p>
                </div>
                <div class="w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://i.imgur.com/1jFnQ4S.jpeg" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://i.imgur.com/2ZhNraw.jpeg" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://i.imgur.com/fF7AFT5.jpeg" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                </div>
                <div class="mt-16 flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-4">
                    <a href="#guestbook" class="inline-block bg-white text-slate-800 border border-slate-800 text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-100 transition-colors duration-300 shadow-lg">
                        Sign Our Guestbook
                    </a>
                    <a href="#registry" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                        View Our Registry
                    </a>
                     <a href="#schedule" class="inline-block bg-white text-slate-800 border border-slate-800 text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-100 transition-colors duration-300 shadow-lg">
                        View the Schedule
                    </a>
                </div>
            </section>
            
            <!-- Photos Section -->
            <section id="photos-section" class="page-section hidden bg-white py-16 md:py-24">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 mb-4">Our Photos</h2>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/wsfDnAE.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/XSlqJHC.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/NmiKhgd.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/BtxyFBX.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/xr2xy81.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://i.imgur.com/q1KNYBn.jpeg" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                    </div>
                </div>
            </section>

            <!-- Registry Section -->
            <section id="registry-section" class="page-section hidden py-16 md:py-24">
                <div class="container mx-auto px-6 text-center">
                    <p class="text-lg text-slate-500 max-w-3xl mx-auto mb-8">
                        The most important gift to us is having you in our lives to share our joy. No gifts are needed or expected. For those who have expressed an interest, we have created a registry with a few options to help us with the next chapter in our journey together.
                    </p>
                    <a href="https://withjoy.com/jeanmarie-and-demetrios/registry" target="_blank" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                        View Our Registry
                    </a>
                </div>
            </section>

            <!-- Guestbook / Message Board Section -->
            <section id="guestbook-section" class="page-section hidden bg-white py-16 md:py-24">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 text-center mb-12">Guestbook</h2>
                    <div class="max-w-3xl mx-auto">
                        <!-- Message Form -->
                        <div class="bg-slate-100 p-6 rounded-2xl mb-8 shadow-inner">
                            <h3 class="text-2xl font-display mb-4">Leave us a message!</h3>
                            <form id="guestbook-form" class="space-y-4">
                                <input id="guest-name" type="text" placeholder="Your Name(s)" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500" required>
                                <textarea id="guest-message" placeholder="Your message..." rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500" required></textarea>
                                <button id="guestbook-submit-btn" type="submit" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors duration-300 font-bold disabled:bg-slate-400" disabled>Authenticating...</button>
                                <p id="guestbook-error" class="text-red-500 text-sm text-center hidden"></p>
                            </form>
                        </div>
                        <!-- Messages Display -->
                        <div id="guestbook-messages" class="space-y-6 h-[60vh] overflow-y-auto pr-4">
                            <p class="text-slate-500 text-center" id="loading-messages">Loading messages...</p>
                        </div>
                    </div>
                </div>
            </section>
            
             <!-- Schedule Section -->
            <section id="schedule-section" class="page-section hidden py-16 md:py-24 bg-slate-50">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 mb-12">Weekend Schedule</h2>
                    <div class="max-w-3xl mx-auto text-left space-y-8">
                        <div class="p-6 bg-white rounded-lg shadow-sm">
                            <h3 class="font-display text-2xl text-slate-700">Before the Day</h3>
                            <p class="font-semibold text-slate-500">August 30th - September 1st, 2025</p>
                            <p class="mt-2 text-slate-600">As we make our final preparations for the big day, our schedule will be quite full. For our guests arriving in town early, we would love to see you if time permits! Please feel free to reach out, and we'll do our best to coordinate.</p>
                        </div>
                        <div class="p-6 bg-white rounded-lg shadow-sm">
                            <h3 class="font-display text-2xl text-slate-700">The Ceremony</h3>
                            <p class="font-semibold text-slate-500">Saturday, September 2nd, 2025 at 4:15 PM</p>
                            <p class="mt-2 text-slate-600">We are having a small, private ceremony in San Francisco. For those who wish to be part of our day, we would be delighted to have you greet us outside the ceremony location afterward. We appreciate your understanding and support!</p>
                        </div>
                        <div class="p-6 bg-white rounded-lg shadow-sm">
                            <h3 class="font-display text-2xl text-slate-700">Reception</h3>
                            <p class="font-semibold text-slate-500">Saturday, September 2nd, 2025 at 7:00 PM</p>
                            <p class="mt-2 text-slate-600">We are still finalizing the perfect location to celebrate with everyone! Our reception will be held either in San Francisco, near the ceremony, or in the San Mateo area. Please check back for updates, and don't hesitate to contact us with any planning questions.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Local Guide Section -->
            <section id="local-guide-section" class="page-section hidden py-16 md:py-24">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 text-center mb-12">A Guide to the Area</h2>
                    <div class="max-w-5xl mx-auto grid md:grid-cols-1 lg:grid-cols-3 gap-10 text-left">
                        <!-- Restaurants (Peninsula) -->
                        <div>
                            <h3 class="font-display text-2xl text-slate-700 mb-4 border-b-2 pb-2">Restaurants (Peninsula)</h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Evvia+Estiatorio+Palo+Alto" target="_blank" class="hover:text-slate-500">Evvia Estiatorio</a></h4>
                                    <p class="text-slate-600">Upscale, lively Greek food in Palo Alto. Reservations are a must.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Kincaid's+Bayhouse+Burlingame" target="_blank" class="hover:text-slate-500">Kincaid's</a></h4>
                                    <p class="text-slate-600">Classic American steakhouse with beautiful bay views in Burlingame.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Zareen's+Redwood+City" target="_blank" class="hover:text-slate-500">Zareen's</a></h4>
                                    <p class="text-slate-600">Popular and casual spot for delicious Pakistani/Indian food.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Foreigner+Restaurant+San+Mateo" target="_blank" class="hover:text-slate-500">Foreigner</a></h4>
                                    <p class="text-slate-600">Modern and very popular brunch spot in San Mateo.</p>
                                </div>
                                 <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Pausa+Bar+%26+Cookery+San+Mateo" target="_blank" class="hover:text-slate-500">Pausa Bar & Cookery</a></h4>
                                    <p class="text-slate-600">Stylish Italian spot for pizza, pasta & more in San Mateo.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Restaurants in San Francisco -->
                        <div>
                            <h3 class="font-display text-2xl text-slate-700 mb-4 border-b-2 pb-2">Restaurants (San Francisco)</h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Souvla+San+Francisco" target="_blank" class="hover:text-slate-500">Souvla</a></h4>
                                    <p class="text-slate-600">Fast, fine Greek sandwiches, salads, and frozen yogurt.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=La+Taqueria+San+Francisco" target="_blank" class="hover:text-slate-500">La Taqueria</a></h4>
                                    <p class="text-slate-600">An iconic, no-frills Mission spot for some of the best burritos.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=State+Bird+Provisions+San+Francisco" target="_blank" class="hover:text-slate-500">State Bird Provisions</a></h4>
                                    <p class="text-slate-600">Unique American small plates served dim-sum style.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Nopa+San+Francisco" target="_blank" class="hover:text-slate-500">Nopa</a></h4>
                                    <p class="text-slate-600">A beloved SF institution for urban rustic food.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=The+House+San+Francisco" target="_blank" class="hover:text-slate-500">The House</a></h4>
                                    <p class="text-slate-600">Cozy spot famous for its delicious Asian fusion dishes.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Things to Do -->
                        <div>
                            <h3 class="font-display text-2xl text-slate-700 mb-4 border-b-2 pb-2">Things To Do</h3>
                            <div class="space-y-4">
                               <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Filoli+Historic+House+%26+Garden" target="_blank" class="hover:text-slate-500">Filoli Gardens</a></h4>
                                    <p class="text-slate-600">Explore a magnificent historic estate and stunning formal gardens.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Golden+Gate+Bridge" target="_blank" class="hover:text-slate-500">Golden Gate Bridge</a></h4>
                                    <p class="text-slate-600">Walk, bike, or drive across the iconic landmark.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Muir+Woods" target="_blank" class="hover:text-slate-500">Muir Woods</a></h4>
                                    <p class="text-slate-600">Wander through a beautiful forest of giant redwood trees.</p>
                                </div>
                                 <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Sawyer+Camp+Trail" target="_blank" class="hover:text-slate-500">Sawyer Camp Trail</a></h4>
                                    <p class="text-slate-600">A beautiful, flat 6-mile paved trail for walking or biking.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Central+Park+San+Mateo" target="_blank" class="hover:text-slate-500">Central Park, San Mateo</a></h4>
                                    <p class="text-slate-600">Features a lovely Japanese Tea Garden, playground, and more.</p>
                                </div>
                            </div>
                        </div>
                        
                         <!-- Hotels -->
                        <div class="lg:col-span-3 mt-10">
                            <h3 class="font-display text-3xl text-slate-700 mb-4 border-b-2 pb-2 text-center">Hotel Recommendations</h3>
                            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                               <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Residence+Inn+San+Francisco+Airport+Millbrae+Station" target="_blank" class="hover:text-slate-500">Residence Inn SFO Millbrae</a></h4>
                                    <p class="text-slate-600">Great for longer stays with kitchenettes, near SFO/BART.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=The+Westin+San+Francisco+Airport" target="_blank" class="hover:text-slate-500">The Westin SFO</a></h4>
                                    <p class="text-slate-600">Convenient and comfortable, located in Millbrae near the airport.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Hilton+Garden+Inn+San+Mateo" target="_blank" class="hover:text-slate-500">Hilton Garden Inn San Mateo</a></h4>
                                    <p class="text-slate-600">A reliable and modern option in San Mateo.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Courtyard+San+Mateo+Foster+City" target="_blank" class="hover:text-slate-500">Courtyard Foster City</a></h4>
                                    <p class="text-slate-600">Modern hotel with waterfront views in Foster City.</p>
                                </div>
                                 <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=The+Stanford+Park+Hotel" target="_blank" class="hover:text-slate-500">Stanford Park Hotel</a></h4>
                                    <p class="text-slate-600">Upscale and classic hotel located in Menlo Park.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold"><a href="https://www.google.com/maps/search/?api=1&query=Hotel+Citrine,+Palo+Alto" target="_blank" class="hover:text-slate-500">Hotel Citrine</a></h4>
                                    <p class="text-slate-600">A stylish and modern Tribute Portfolio hotel in Palo Alto.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Transportation Section -->
                        <div class="lg:col-span-3 mt-10">
                            <h3 class="font-display text-3xl text-slate-700 mb-4 border-b-2 pb-2 text-center">Transportation</h3>
                            <div class="grid md:grid-cols-3 gap-8 text-left">
                                <div>
                                    <h4 class="font-bold">Rideshare & Taxis</h4>
                                    <p class="text-slate-600">Uber and Lyft are widely available throughout the Bay Area and are a convenient way to get around for shorter trips or to/from the airports.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold">Rental Cars</h4>
                                    <p class="text-slate-600">For the most flexibility, you can rent a car from SFO or SJC airports. This is a great option if you plan to explore different parts of the Bay Area.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold">Public Transportation</h4>
                                    <p class="text-slate-600">BART connects SFO to the Peninsula, and Caltrain runs from San Francisco down to San Jose, with stops in most cities in between. It's a great option for traveling up and down the peninsula without a car.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="bg-slate-800 text-white mt-16 py-8 text-center">
            <nav class="mb-4">
                <div class="flex justify-center items-center space-x-4 md:space-x-6 text-lg">
                    <a href="#home" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Home</a>
                    <a href="#photos" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Photos</a>
                    <a href="#registry" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Registry</a>
                    <a href="#guestbook" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Guestbook</a>
                    <a href="#schedule" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Schedule</a>
                    <a href="#local-guide" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors whitespace-nowrap">Local Guide</a>
                </div>
            </nav>
            <p class="font-display text-2xl">JeanMarie & Demetrios</p>
            <p>Counting down the days!</p>
        </footer>

    </div>

    <script type="module">
        // --- Firebase SDK Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDs5zdnRX1xU_TDhycw24TdWL34cCRNUWE",
            authDomain: "wedding-site-d94ea.firebaseapp.com",
            projectId: "wedding-site-d94ea",
            storageBucket: "wedding-site-d94ea.appspot.com",
            messagingSenderId: "147291122854",
            appId: "1:147291122854:web:7e06f0e0b8b52e07c45867",
            measurementId: "G-SDV1W7E77X"
        };
        
        const SITE_PASSWORD = 'ourday';
        const passwordModal = document.getElementById('password-modal');
        const passwordForm = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const passwordError = document.getElementById('password-error');
        const appContent = document.getElementById('app-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        const guestbookForm = document.getElementById('guestbook-form');
        const guestNameInput = document.getElementById('guest-name');
        const guestMessageInput = document.getElementById('guest-message');
        const guestbookMessagesContainer = document.getElementById('guestbook-messages');
        const loadingMessages = document.getElementById('loading-messages');
        const guestbookSubmitBtn = document.getElementById('guestbook-submit-btn');
        const guestbookError = document.getElementById('guestbook-error');
        let db, auth;
        
        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (passwordInput.value === SITE_PASSWORD) {
                passwordModal.style.display = 'none';
                appContent.style.display = 'block';
                initializeAppLogic();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
            }
        });

        function handleNavigation() {
            const hash = window.location.hash || '#home';
            navLinks.forEach(link => {
                link.classList.toggle('active', link.hash === hash);
            });
            pageSections.forEach(section => {
                section.style.display = section.id === `${hash.substring(1)}-section` ? 'block' : 'none';
            });
        }
        
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                setTimeout(handleNavigation, 0);
            });
        });

        function initializeAppLogic() {
            handleNavigation();
            window.addEventListener('hashchange', handleNavigation);
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setupAuthAndGuestbook();
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                guestbookMessagesContainer.innerHTML = `<p class="text-center text-red-500">Guestbook could not be loaded.</p>`;
            }
        }

        function setupAuthAndGuestbook() {
            onAuthStateChanged(auth, user => {
                if (user) {
                    guestbookSubmitBtn.disabled = false;
                    guestbookSubmitBtn.textContent = 'Post Message';
                } else {
                    guestbookSubmitBtn.disabled = true;
                    guestbookSubmitBtn.textContent = 'Authentication Failed';
                }
            });
            signInAnonymously(auth)
                .then(() => {
                    listenForGuestbookMessages();
                })
                .catch(error => {
                    console.error("Anonymous sign-in failed:", error);
                    guestbookSubmitBtn.textContent = 'Authentication Failed';
                    guestbookError.textContent = 'Could not connect to the guestbook service.';
                    guestbookError.classList.remove('hidden');
                });
        }

        function listenForGuestbookMessages() {
            const messagesCollection = collection(db, 'guestbook_messages');
            const q = query(messagesCollection);
            onSnapshot(q, (snapshot) => {
                loadingMessages.style.display = 'none';
                const messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                messages.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));
                guestbookMessagesContainer.innerHTML = '';
                if (messages.length === 0) {
                    guestbookMessagesContainer.innerHTML = `<p class="text-center text-slate-500">No messages yet. Be the first to write in our guestbook!</p>`;
                } else {
                    messages.forEach(renderMessage);
                }
            }, (error) => {
                console.error("Error fetching messages:", error);
                guestbookMessagesContainer.innerHTML = `<p class="text-center text-red-500">Error loading messages.</p>`;
            });
        }

        function renderMessage(msg) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'bg-slate-50 p-5 rounded-xl shadow-sm';
            const messageHeader = document.createElement('div');
            messageHeader.className = 'flex justify-between items-center mb-2';
            const nameEl = document.createElement('p');
            nameEl.className = 'font-bold text-slate-700';
            nameEl.textContent = msg.name || 'Anonymous';
            const dateEl = document.createElement('p');
            dateEl.className = 'text-xs text-slate-400';
            dateEl.textContent = msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleString() : '';
            messageHeader.appendChild(nameEl);
            messageHeader.appendChild(dateEl);
            const messageText = document.createElement('p');
            messageText.className = 'text-slate-600';
            messageText.textContent = msg.message || '';
            messageDiv.appendChild(messageHeader);
            messageDiv.appendChild(messageText);
            guestbookMessagesContainer.appendChild(messageDiv);
        }

        guestbookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = guestNameInput.value.trim();
            const message = guestMessageInput.value.trim();
            guestbookError.classList.add('hidden');
            if (!auth.currentUser) {
                guestbookError.textContent = "Authentication issue. Please refresh and try again.";
                guestbookError.classList.remove('hidden');
                return;
            }
            if (name === '' || message === '') {
                guestbookError.textContent = "Please fill out both your name and a message.";
                guestbookError.classList.remove('hidden');
                return;
            }
            try {
                const messagesCollection = collection(db, 'guestbook_messages');
                await addDoc(messagesCollection, {
                    name: name,
                    message: message,
                    timestamp: serverTimestamp(),
                    userId: auth.currentUser.uid
                });
                guestNameInput.value = '';
                guestMessageInput.value = '';
            } catch (error) {
                console.error("Error sending message:", error);
                guestbookError.textContent = "There was an error posting your message. Please try again.";
                guestbookError.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
