<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JeanMarie & Demetrios's Engagement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', sans-serif;
        }
        h1, h2, h3, .font-display {
            font-family: 'Playfair Display', serif;
        }
        /* Custom scrollbar for message board */
        #guestbook-messages::-webkit-scrollbar {
            width: 8px;
        }
        #guestbook-messages::-webkit-scrollbar-track {
            background: #f8fafc;
        }
        #guestbook-messages::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .nav-link.active {
            /* Changed to white to show on dark header */
            border-bottom-color: #ffffff;
            color: #ffffff;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700">

    <!-- Password Protection Modal -->
    <div id="password-modal" class="fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full text-center">
            <h2 class="text-3xl font-display mb-2">JeanMarie & Demetrios</h2>
            <p class="text-slate-500 mb-6">Please enter the password to view our site.</p>
            <form id="password-form">
                <!-- Accent color updated to slate -->
                <input id="password-input" type="password" class="w-full p-3 border border-slate-300 rounded-lg text-center focus:outline-none focus:ring-2 focus:ring-slate-500" placeholder="Password">
                <p id="password-error" class="text-red-500 text-sm mt-2 hidden">Incorrect password. Please try again.</p>
                <!-- Button color updated to slate -->
                <button type="submit" class="w-full mt-4 bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors duration-300 font-bold">Enter</button>
            </form>
        </div>
    </div>

    <!-- Main App Content (hidden until password is correct) -->
    <div id="app-content" class="hidden">
        <!-- Header updated to match footer -->
        <header class="bg-slate-800 shadow-md sticky top-0 z-40">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <!-- Text color updated to white -->
                <div class="font-display text-2xl font-bold text-white">J & D</div>
                <div class="flex items-center space-x-6 md:space-x-8 text-lg">
                    <!-- Text and hover colors updated for dark background -->
                    <a href="#home" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors">Home</a>
                    <a href="#photos" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors">Photos</a>
                    <a href="#registry" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors">Registry</a>
                    <a href="#guestbook" class="nav-link text-slate-300 hover:text-white border-b-2 border-transparent transition-colors">Guestbook</a>
                </div>
            </nav>
        </header>

        <main>
            <!-- Home Section -->
            <section id="home-section" class="page-section container mx-auto px-6 py-16 md:py-24 text-center">
                <div class="mb-12">
                    <h1 class="text-5xl md:text-7xl font-display text-slate-800 mb-4">We're Engaged!</h1>
                    <p class="text-xl text-slate-500 max-w-3xl mx-auto">
                        We're so excited to share this special time in our lives with you. Welcome to our engagement website, where you can find photos, registry information, and leave us a message!
                    </p>
                </div>
                <div class="w-full max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-4">
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://placehold.co/800x1200/a3bffa/ffffff?text=JeanMarie+%26+Demetrios+1" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://placehold.co/800x1200/a3bffa/ffffff?text=JeanMarie+%26+Demetrios+2" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                     <div class="h-80 rounded-2xl shadow-xl overflow-hidden"><img src="https://placehold.co/800x1200/a3bffa/ffffff?text=JeanMarie+%26+Demetrios+3" onerror="this.onerror=null;this.src='https://placehold.co/800x1200/cccccc/ffffff?text=Image+Not+Found';" alt="JeanMarie and Demetrios" class="w-full h-full object-cover"></div>
                </div>
                <div class="mt-16">
                    <a href="https://withjoy.com/jeanmarie-and-demetrios/registry" target="_blank" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                        View Our Registry
                    </a>
                </div>
            </section>
            
            <!-- Photos Section -->
            <section id="photos-section" class="page-section hidden bg-white py-16 md:py-24">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 mb-4">Our Story & Photos</h2>
                    <p class="text-lg text-slate-500 max-w-3xl mx-auto mb-12">
                        From our first date to the proposal, here are a few moments from our journey together. We can't wait to create many more memories.
                    </p>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=Our+First+Trip" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=The+Proposal" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=Holidays" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=Adventures" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=Just+Us" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                        <div class="rounded-lg overflow-hidden shadow-lg aspect-w-1 aspect-h-1"><img src="https://placehold.co/600x600/a3bffa/ffffff?text=Celebrations" class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-300"></div>
                    </div>
                    <div class="mt-16">
                        <a href="https://withjoy.com/jeanmarie-and-demetrios/registry" target="_blank" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                            View Our Registry
                        </a>
                    </div>
                </div>
            </section>

            <!-- Registry Section -->
            <section id="registry-section" class="page-section hidden py-16 md:py-24">
                <div class="container mx-auto px-6 text-center">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 mb-4">Gift Registry</h2>
                    <p class="text-lg text-slate-500 max-w-3xl mx-auto mb-8">
                        Your presence at our wedding is the greatest gift of all. However, if you wish to honor us with a gift, we have registered for items we would love to have in our new home.
                    </p>
                    <a href="https://withjoy.com/jeanmarie-and-demetrios/registry" target="_blank" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                        View Our Registry
                    </a>
                </div>
            </section>

            <!-- Guestbook / Message Board Section -->
            <section id="guestbook-section" class="page-section hidden bg-white py-16 md:py-24">
                <div class="container mx-auto px-6">
                    <h2 class="text-4xl md:text-5xl font-display text-slate-800 text-center mb-12">Guestbook</h2>
                    <div class="max-w-3xl mx-auto">
                        <!-- Message Form -->
                        <div class="bg-slate-100 p-6 rounded-2xl mb-8 shadow-inner">
                            <h3 class="text-2xl font-display mb-4">Leave us a message!</h3>
                            <form id="guestbook-form" class="space-y-4">
                                <input id="guest-name" type="text" placeholder="Your Name(s)" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500" required>
                                <textarea id="guest-message" placeholder="Your message..." rows="4" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-slate-500" required></textarea>
                                <button type="submit" class="w-full bg-slate-800 text-white py-3 rounded-lg hover:bg-slate-700 transition-colors duration-300 font-bold">Post Message</button>
                            </form>
                        </div>
                        <!-- Messages Display -->
                        <div id="guestbook-messages" class="space-y-6 h-[60vh] overflow-y-auto pr-4">
                            <p class="text-slate-500 text-center" id="loading-messages">Loading messages...</p>
                            <!-- Messages will be injected here by Firebase -->
                        </div>
                    </div>
                    <div class="mt-16 text-center">
                        <a href="https://withjoy.com/jeanmarie-and-demetrios/registry" target="_blank" class="inline-block bg-slate-800 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-slate-700 transition-colors duration-300 shadow-lg">
                            View Our Registry
                        </a>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="bg-slate-800 text-white mt-16 py-8 text-center">
            <p class="font-display text-2xl">JeanMarie & Demetrios</p>
            <p>Counting down the days!</p>
        </footer>

    </div>

    <script type="module">
        // --- Firebase SDK Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- Firebase Configuration ---
        // This is your personal Firebase config object.
        const firebaseConfig = {
            apiKey: "AIzaSyDs5zdnRX1xU_TDhycw24TdWL34cCRNUWE",
            authDomain: "wedding-site-d94ea.firebaseapp.com",
            projectId: "wedding-site-d94ea",
            storageBucket: "wedding-site-d94ea.appspot.com",
            messagingSenderId: "147291122854",
            appId: "1:147291122854:web:7e06f0e0b8b52e07c45867",
            measurementId: "G-SDV1W7E77X"
        };
        
        // --- CONFIGURATION ---
        // Change this password to whatever you want
        const SITE_PASSWORD = 'ourday';

        // --- DOM Elements ---
        const passwordModal = document.getElementById('password-modal');
        const passwordForm = document.getElementById('password-form');
        const passwordInput = document.getElementById('password-input');
        const passwordError = document.getElementById('password-error');
        const appContent = document.getElementById('app-content');
        
        const navLinks = document.querySelectorAll('.nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        
        const guestbookForm = document.getElementById('guestbook-form');
        const guestNameInput = document.getElementById('guest-name');
        const guestMessageInput = document.getElementById('guest-message');
        const guestbookMessagesContainer = document.getElementById('guestbook-messages');
        const loadingMessages = document.getElementById('loading-messages');

        // --- Firebase Globals ---
        let db, auth;
        
        // --- PASSWORD PROTECTION LOGIC ---
        passwordForm.addEventListener('submit', (e) => {
            e.preventDefault();
            if (passwordInput.value === SITE_PASSWORD) {
                passwordModal.style.display = 'none';
                appContent.style.display = 'block';
                // Initialize the app after successful login
                initializeAppLogic();
            } else {
                passwordError.style.display = 'block';
                passwordInput.value = '';
            }
        });

        // --- SINGLE PAGE APP NAVIGATION ---
        function handleNavigation() {
            const hash = window.location.hash || '#home';
            
            navLinks.forEach(link => {
                link.classList.toggle('active', link.hash === hash);
            });

            pageSections.forEach(section => {
                section.style.display = section.id === `${hash.substring(1)}-section` ? 'block' : 'none';
            });
        }
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                // e.preventDefault(); is not used to allow the hash to change
                setTimeout(handleNavigation, 0); // Use timeout to ensure hash has changed
            });
        });

        // --- MAIN APP INITIALIZATION ---
        function initializeAppLogic() {
            handleNavigation(); // Set initial page view
            window.addEventListener('hashchange', handleNavigation);

            // Initialize Firebase
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setupAuthAndGuestbook();
            } catch (error) {
                console.error("Firebase initialization failed:", error);
                guestbookMessagesContainer.innerHTML = `<p class="text-center text-red-500">Guestbook could not be loaded.</p>`;
            }
        }

        // --- GUESTBOOK (FIREBASE) LOGIC ---
        function setupAuthAndGuestbook() {
            onAuthStateChanged(auth, user => {
                if (!user) {
                    signInAnonymously(auth).catch(error => {
                        console.error("Anonymous sign-in failed:", error);
                    });
                }
                 // Once we have a user (anonymous or not), listen for messages
                listenForGuestbookMessages();
            });
        }

        function listenForGuestbookMessages() {
            const messagesCollection = collection(db, 'guestbook_messages');
            const q = query(messagesCollection);

            onSnapshot(q, (snapshot) => {
                loadingMessages.style.display = 'none';
                
                const messages = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                // Sort messages by timestamp, newest first
                messages.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));

                guestbookMessagesContainer.innerHTML = ''; // Clear old messages

                if (messages.length === 0) {
                    guestbookMessagesContainer.innerHTML = `<p class="text-center text-slate-500">No messages yet. Be the first to write in our guestbook!</p>`;
                } else {
                    messages.forEach(renderMessage);
                }
            }, (error) => {
                console.error("Error fetching messages:", error);
                guestbookMessagesContainer.innerHTML = `<p class="text-center text-red-500">Error loading messages.</p>`;
            });
        }

        function renderMessage(msg) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'bg-slate-50 p-5 rounded-xl shadow-sm';

            const messageHeader = document.createElement('div');
            messageHeader.className = 'flex justify-between items-center mb-2';

            const nameEl = document.createElement('p');
            nameEl.className = 'font-bold text-slate-700';
            nameEl.textContent = msg.name || 'Anonymous';

            const dateEl = document.createElement('p');
            dateEl.className = 'text-xs text-slate-400';
            dateEl.textContent = msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleString() : '';

            messageHeader.appendChild(nameEl);
            messageHeader.appendChild(dateEl);

            const messageText = document.createElement('p');
            messageText.className = 'text-slate-600';
            // Simple sanitization to prevent HTML injection
            messageText.textContent = msg.message || '';

            messageDiv.appendChild(messageHeader);
            messageDiv.appendChild(messageText);

            guestbookMessagesContainer.appendChild(messageDiv);
        }

        guestbookForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = guestNameInput.value.trim();
            const message = guestMessageInput.value.trim();

            if (!auth.currentUser) {
                alert("You must be signed in to post a message. Please refresh the page.");
                return;
            }
            if (name === '' || message === '') {
                alert("Please fill out both your name and a message.");
                return;
            }
            
            try {
                const messagesCollection = collection(db, 'guestbook_messages');
                await addDoc(messagesCollection, {
                    name: name,
                    message: message,
                    timestamp: serverTimestamp(),
                    userId: auth.currentUser.uid
                });
                guestNameInput.value = '';
                guestMessageInput.value = '';
            } catch (error) {
                console.error("Error sending message:", error);
                alert("There was an error posting your message. Please try again.");
            }
        });

    </script>
</body>
</html>
